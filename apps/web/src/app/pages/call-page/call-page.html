<app-side-bar
  [activeSection]="currentSection()"
  (settingsClick)="openSettings()"
  (sectionChange)="onSectionChange($event)"
></app-side-bar>

<div class="call-window">
  @if (error(); as e) {
    <div class="user-display">
      <p class="error">{{ e }}</p>
    </div>
  } @else {
    <div class="user-display">
      @if (localUser(); as me) {
        <div
          class="user-avatar-card"
          [class.speaking]="isLocalSpeaking()"
          [style.border-color]="me.profile?.accentColor || '#2c2f3a'"
        >
          @if (me.profile?.avatarUrl) {
            <img [src]="me.profile?.avatarUrl" [alt]="me.profile?.displayName || me.username" />
          } @else {
            <span>{{ (me.profile?.displayName || me.username || '?')[0] }}</span>
          }
        </div>
      }

      @if (remoteUser(); as other) {
        <div
          class="user-avatar-card"
          [class.speaking]="isRemoteSpeaking()"
          [style.border-color]="other.profile?.accentColor || '#2c2f3a'"
        >
          @if (other.profile?.avatarUrl) {
            <img [src]="other.profile?.avatarUrl" [alt]="other.profile?.displayName || other.username" />
          } @else {
            <span>{{ (other.profile?.displayName || other.username || '?')[0] }}</span>
          }
        </div>
      }
    </div>

    <div class="call-tool-bar">
      <div class="tool-bar">
        <audio #remoteAudio autoplay></audio>

        <div class="btn-con">
          <button class="btn mute" type="button" (click)="toggleMute()">
            <fa-icon [icon]="isMuted() ? faMicrophoneSlash : faMicrophone"></fa-icon>
          </button>

          <div class="volume-control">
            <button
              type="button"
              class="btn volume-toggle"
              (click)="toggleVolumeSlider()"
            >
              <fa-icon [icon]="volumeIcon()"></fa-icon>
            </button>

            @if (showVolumeSlider()) {
              <div class="volume-slider">
                <div class="volume-slider-inner">
                  <input
                    type="range"
                    min="0"
                    max="1"
                    step="0.01"
                    [value]="remoteVolume()"
                    (input)="onVolumeChange($event)"
                    [style.--volume]="(remoteVolume() * 100) + '%'"
                  />
                </div>
              </div>
            }
          </div>

          <button class="btn hangup" type="button" (click)="hangup()">
            <fa-icon [icon]="faPhoneSlash"></fa-icon>
          </button>
        </div>

        <fa-icon
          [icon]="faWifi"
          class="wifi-icon"
          [class.bad]="connecting()"
        ></fa-icon>
      </div>
    </div>
  }
</div>
